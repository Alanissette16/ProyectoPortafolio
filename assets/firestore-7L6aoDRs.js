import{q as b,w as v,g as f,i as y,h as n,k,m as p,p as E,s as u,n as T,t as j,o as V}from"./index-BH4wJvy1.js";class P{constructor(t=0,r="Network Error"){this.status=t,this.text=r}}const x=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},i={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:x()},q=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},K=(e,t="https://api.emailjs.com")=>{if(!e)return;const r=q(e);i.publicKey=r.publicKey,i.blockHeadless=r.blockHeadless,i.storageProvider=r.storageProvider,i.blockList=r.blockList,i.limitRate=r.limitRate,i.origin=r.origin||t},R=async(e,t,r={})=>{const s=await fetch(i.origin+e,{method:"POST",headers:r,body:t}),a=await s.text(),o=new P(s.status,a);if(s.ok)return o;throw o},L=(e,t,r)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||typeof r!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},O=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},_=e=>e.webdriver||!e.languages||e.languages.length===0,B=()=>new P(451,"Unavailable For Headless Browser"),C=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},M=e=>!e.list?.length||!e.watchVariable,z=(e,t)=>e instanceof FormData?e.get(t):e[t],S=(e,t)=>{if(M(e))return!1;C(e.list,e.watchVariable);const r=z(t,e.watchVariable);return typeof r!="string"?!1:e.list.includes(r)},A=()=>new P(403,"Forbidden"),W=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},J=async(e,t,r)=>{const s=Number(await r.get(e)||0);return t-Date.now()+s},F=async(e,t,r)=>{if(!t.throttle||!r)return!1;W(t.throttle,t.id);const s=t.id||e;return await J(s,t.throttle,r)>0?!0:(await r.set(s,Date.now().toString()),!1)},H=()=>new P(429,"Too Many Requests"),G=async(e,t,r,s)=>{const a=q(s),o=a.publicKey||i.publicKey,g=a.blockHeadless||i.blockHeadless,h=a.storageProvider||i.storageProvider,w={...i.blockList,...a.blockList},l={...i.limitRate,...a.limitRate};return g&&_(navigator)?Promise.reject(B()):(L(o,e,t),O(r),r&&S(w,r)?Promise.reject(A()):await F(location.pathname,l,h)?Promise.reject(H()):R("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:o,service_id:e,template_id:t,template_params:r}),{"Content-type":"application/json"}))},U=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Q=e=>typeof e=="string"?document.querySelector(e):e,X=async(e,t,r,s)=>{const a=q(s),o=a.publicKey||i.publicKey,g=a.blockHeadless||i.blockHeadless,h=i.storageProvider||a.storageProvider,w={...i.blockList,...a.blockList},l={...i.limitRate,...a.limitRate};if(g&&_(navigator))return Promise.reject(B());const d=Q(r);L(o,e,t),U(d);const m=new FormData(d);return S(w,m)?Promise.reject(A()):await F(location.pathname,l,h)?Promise.reject(H()):(m.append("lib_version","4.4.1"),m.append("service_id",e),m.append("template_id",t),m.append("user_id",o),R("/api/v1.0/email/send-form",m))},Y={init:K,send:G,sendForm:X,EmailJSResponseStatus:P},Z="service_jcoyc8l",$="template_shudliq",ee="template_zijzaul",te="2hWPAgjtrE7y_w85W",re=e=>!!e,D=async(e,t)=>{if(re(e))try{await Y.send(Z,e,t,{publicKey:te})}catch(r){console.error("Error al enviar correo:",r)}},se=async e=>{e.programmerEmail&&await D(ee,{to_email:e.programmerEmail,programmer_name:e.programmerName||"Programador",requester_name:e.requesterName,requester_email:e.requesterEmail,date:e.date,time:e.time,note:e.note||"Sin comentarios adicionales."})},ae=async e=>{e.requesterEmail&&await D($,{to_email:e.requesterEmail,requester_name:e.requesterName||"Cliente",programmer_name:e.programmerName||"Programador",status:e.status,date:e.date||"Fecha por confirmar",time:e.time||"Hora por confirmar",response_message:e.responseMessage||(e.status==="aprobada"?"Tu solicitud fue aprobada.":"Tu solicitud fue rechazada.")})},c={users:"users",portfolios:"portfolios",projects:"projects",schedules:"schedules",advisories:"advisories"},I=async(e,t)=>{if(!e)return t||{};try{const r=p(n,c.users,e),s=await E(r);if(!s.exists())return t||{};const a=s.data();return{programmerEmail:a.email||t?.programmerEmail,programmerName:a.displayName||t?.programmerName}}catch(r){return console.error("No se pudo obtener el contacto del programador:",r),t||{}}},ne=async(e,t)=>{try{await j(p(n,c.users,e),{...t,updatedAt:u()})}catch(r){throw console.error("Error en upsertProgrammer:",r),r}},ce=async()=>{const e=b(f(n,c.users),v("role","==","programmer"));return(await y(e)).docs.map(r=>({id:r.id,...r.data()}))},me=async e=>{await V(p(n,c.users,e))},le=async e=>{const t=p(n,c.portfolios,e),r=await E(t);return r.exists()?r.data():null},de=async(e,t)=>{await j(p(n,c.portfolios,e),{...t,ownerId:e,updatedAt:u()})},ue=async e=>{const t=b(f(n,c.projects),v("ownerId","==",e));return(await y(t)).docs.map(s=>({id:s.id,...s.data()}))},pe=async(e,t)=>await T(f(n,c.projects),{...t,ownerId:e,createdAt:u(),updatedAt:u()}),ge=async(e,t)=>k(p(n,c.projects,e),{...t,updatedAt:u()}),fe=async()=>(await y(f(n,c.projects))).docs.map(t=>({id:t.id,...t.data()})),he=async e=>{console.log("ðŸ“ Guardando asesorÃ­a...",e);const t=await I(e.programmerId,{programmerEmail:e.programmerEmail,programmerName:e.programmerName}),r={...e,programmerEmail:t.programmerEmail,programmerName:t.programmerName,status:"pendiente",createdAt:u(),updatedAt:u()};console.log("ðŸ“¦ Payload a guardar:",r);const s=await T(f(n,c.advisories),r);console.log("âœ… AsesorÃ­a guardada con ID:",s.id);try{await se({programmerEmail:r.programmerEmail,programmerName:r.programmerName,requesterName:e.requesterName,requesterEmail:e.requesterEmail,date:e.slot.date,time:e.slot.time,note:e.note})}catch(a){console.warn("âš ï¸ Error enviando email (no crÃ­tico):",a)}return s},we=async(e,t)=>{const r=b(f(n,c.advisories),v("programmerId","==",e)),a=(await y(r)).docs.map(l=>({id:l.id,...l.data()}));let o=[];if(t){const l=b(f(n,c.advisories),v("programmerEmail","==",t));o=(await y(l)).docs.map(m=>({id:m.id,...m.data()}))}let g=[];if(t){const d={"claudia@foreing.tech":"claudia","valentina@foreing.tech":"valentina","valeria@foreing.tech":"valeria"}[t.toLowerCase()];if(d){const m=b(f(n,c.advisories),v("programmerId","==",d));g=(await y(m)).docs.map(N=>({id:N.id,...N.data()}))}}const h=[...a],w=l=>{l.forEach(d=>{h.find(m=>m.id===d.id)||h.push(d)})};return w(o),w(g),h},ye=async(e,t,r)=>{const s=p(n,c.advisories,e),a=await E(s);if(!a.exists())throw new Error("La asesoria no existe");const o=a.data();await k(s,{status:t,responseMessage:r,updatedAt:u()});const g=await I(o.programmerId,{programmerEmail:o.programmerEmail,programmerName:o.programmerName});await ae({requesterEmail:o.requesterEmail,requesterName:o.requesterName,programmerName:g.programmerName,status:t,date:o.slot?.date,time:o.slot?.time,responseMessage:r})},be=async(e,t)=>{await j(p(n,c.schedules,e),{programmerId:e,slots:t,updatedAt:u()})},ve=async e=>{const t=p(n,c.schedules,e),r=await E(t);return r.exists()?r.data():null};export{ue as a,ce as b,ve as c,he as d,we as e,me as f,le as g,be as h,de as i,ge as j,pe as k,fe as l,ye as m,ne as u};
