import{b as I,r,j as e,g as q,h as R,q as _,w as $,i as L}from"./index-BH4wJvy1.js";import{m as T}from"./firestore-7L6aoDRs.js";import{m as o}from"./proxy-BEHoNeIf.js";import{M as U}from"./message-square-DPCnp8_T.js";import{c as x}from"./createLucideIcon-D0cFDdCY.js";import{U as H}from"./user-BiDy-nnM.js";import{M as P}from"./mail-C3GEX0Kr.js";import{C as X}from"./calendar-BCpUKCmH.js";import{C as G}from"./clock-U-DdIR7r.js";import{C as J}from"./circle-check-big-CUnlqcWj.js";const K=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],F=x("circle-x",K);const O=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Q=x("funnel",O);const V=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],W=x("inbox",V);const Y=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Z=x("refresh-cw",Y),xe=()=>{const{user:A}=I(),[m,y]=r.useState([]),[i,p]=r.useState(!0),[j,b]=r.useState(""),[n,k]=r.useState("todas"),[l,N]=r.useState(null),[a,h]=r.useState({open:!1,advisoryId:"",action:"aprobada",message:""}),u=async()=>{p(!0),b("");try{const s=q(R,"advisories"),t=_(s,$("programmerId","==",A?.uid)),d=await L(t);if(d.empty){y([]),p(!1);return}const B=d.docs.map(c=>({id:c.id,...c.data()})).sort((c,M)=>{const S=c.createdAt?.toDate?.()||new Date(0);return(M.createdAt?.toDate?.()||new Date(0)).getTime()-S.getTime()});y(B)}catch(s){b(`Error: ${s?.message||"No se pudieron cargar las asesorías."}`)}finally{p(!1)}};r.useEffect(()=>{u()},[]);const z=async(s,t,d)=>{N(s);try{await T(s,t,d),await u()}catch{b("No se pudo actualizar el estado.")}finally{N(null)}},v=(s,t)=>{h({open:!0,advisoryId:s,action:t,message:t==="aprobada"?"¡Tu solicitud de asesoría ha sido aprobada! Me pondré en contacto contigo pronto.":"Lamentablemente no puedo atender tu solicitud de asesoría en este momento."})},g=()=>{h({open:!1,advisoryId:"",action:"aprobada",message:""})},D=async()=>{if(!a.message.trim()){alert("Por favor ingresa un mensaje de respuesta");return}await z(a.advisoryId,a.action,a.message),g()},w=n==="todas"?m:m.filter(s=>s.status===n),C=s=>{switch(s){case"pendiente":return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-700",children:"⏳ Pendiente"});case"aprobada":return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700",children:"✓ Aprobada"});case"rechazada":return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:"✗ Rechazada"});default:return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700",children:s})}},f=m.filter(s=>s.status==="pendiente").length;return e.jsxs("div",{className:"relative min-h-screen p-20 mx-auto",children:[e.jsx(o.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-display font-bold text-[#5D4E37] flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-r from-[#D4AF37] to-[#B8860B]",children:e.jsx(U,{className:"text-white",size:24})}),"Asesorías",f>0&&e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-semibold bg-amber-100 text-amber-700",children:[f," nueva",f>1?"s":""]})]}),e.jsx("p",{className:"text-[#8B7355] mt-2 font-body",children:"Revisa y gestiona las solicitudes de asesoría que has recibido"})]}),e.jsxs("button",{onClick:u,disabled:i,className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white border border-[#D4AF37]/30 text-[#5D4E37] font-semibold hover:bg-[#FFF8E7] transition-all disabled:opacity-50",children:[e.jsx(Z,{size:18,className:i?"animate-spin":""}),"Actualizar"]})]})}),e.jsxs(o.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.1},className:"flex flex-wrap items-center gap-2 mb-6",children:[e.jsx(Q,{size:18,className:"text-[#8B7355]"}),e.jsx("span",{className:"text-sm text-[#8B7355] font-body mr-2",children:"Filtrar:"}),[{key:"todas",label:"Todas",color:"bg-gray-100 text-gray-700"},{key:"pendiente",label:"Pendientes",color:"bg-amber-100 text-amber-700"},{key:"aprobada",label:"Aprobadas",color:"bg-green-100 text-green-700"},{key:"rechazada",label:"Rechazadas",color:"bg-red-100 text-red-700"}].map(s=>e.jsx("button",{onClick:()=>k(s.key),className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all ${n===s.key?"bg-gradient-to-r from-[#D4AF37] to-[#B8860B] text-white shadow-md":`${s.color} hover:opacity-80`}`,children:s.label},s.key))]}),j&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-6 p-4 rounded-xl bg-red-50 border border-red-200 text-red-700 flex items-center gap-2",children:[e.jsx(F,{size:18}),j]}),i&&e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-[#D4AF37]/10 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},s))}),!i&&e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center py-16 px-6 rounded-2xl bg-white border border-[#D4AF37]/10",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-r from-[#FFF8E7] to-[#FFF0D4] mb-4",children:e.jsx(W,{className:"text-[#D4AF37]",size:36})}),e.jsxs("h3",{className:"text-xl font-display font-bold text-[#5D4E37] mb-2",children:["No hay solicitudes ",n!=="todas"?n+"s":""]}),e.jsx("p",{className:"text-[#8B7355] font-body",children:"Cuando recibas solicitudes de asesoría aparecerán aquí ✨"})]}):w.map((s,t)=>e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},className:"p-6 rounded-2xl bg-white border border-[#D4AF37]/15 shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-[#D4AF37]/20 to-[#B8860B]/20 flex items-center justify-center",children:e.jsx(H,{className:"text-[#D4AF37]",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display font-bold text-[#5D4E37] text-lg",children:s.requesterName||"Usuario"}),e.jsxs("p",{className:"text-sm text-[#8B7355] flex items-center gap-1",children:[e.jsx(P,{size:14}),s.requesterEmail||"Sin email"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm text-[#5D4E37] bg-[#FFF8E7] px-3 py-1.5 rounded-lg",children:[e.jsx(X,{size:16,className:"text-[#D4AF37]"}),s.slot?.date||"Sin fecha"]}),e.jsxs("span",{className:"flex items-center gap-2 text-sm text-[#5D4E37] bg-[#FFF8E7] px-3 py-1.5 rounded-lg",children:[e.jsx(G,{size:16,className:"text-[#D4AF37]"}),s.slot?.time||"Sin hora"]})]}),s.note&&e.jsx("div",{className:"p-4 rounded-xl bg-[#FFFAF5] border border-[#D4AF37]/10",children:e.jsx("p",{className:"text-sm text-[#5D4E37] font-body whitespace-pre-wrap",children:s.note})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[C(s.status),s.status==="pendiente"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>v(s.id,"aprobada"),disabled:l===s.id,className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-green-500 text-white font-semibold hover:bg-green-600 transition-all disabled:opacity-50",children:[e.jsx(J,{size:18}),"Aprobar"]}),e.jsxs("button",{onClick:()=>v(s.id,"rechazada"),disabled:l===s.id,className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-600 transition-all disabled:opacity-50",children:[e.jsx(F,{size:18}),"Rechazar"]})]})]})]})},s.id))}),a.open&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-[2rem] max-w-md w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:`p-6 ${a.action==="aprobada"?"bg-green-500":"bg-red-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-display font-bold text-white",children:a.action==="aprobada"?"Aprobar Asesoría":"Rechazar Asesoría"}),e.jsx("button",{onClick:g,className:"text-white hover:text-white/80 transition-colors",children:"✕"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-base-content/70 mb-4",children:a.action==="aprobada"?"Ingresa un mensaje de confirmación para el solicitante:":"Ingresa una justificación para el rechazo:"}),e.jsx("textarea",{value:a.message,onChange:s=>h(t=>({...t,message:s.target.value})),rows:4,className:"w-full px-4 py-3 rounded-xl border-2 border-base-300 focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none transition-all resize-none",placeholder:"Escribe tu mensaje aquí..."}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:g,className:"flex-1 px-4 py-3 rounded-xl border-2 border-base-300 text-base-content/70 hover:bg-base-100 transition-all",children:"Cancelar"}),e.jsx("button",{onClick:D,disabled:l===a.advisoryId,className:`flex-1 px-4 py-3 rounded-xl text-white font-semibold transition-all ${a.action==="aprobada"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"} disabled:opacity-50`,children:l===a.advisoryId?"Enviando...":"Enviar"})]})]})]})})]})};export{xe as default};
